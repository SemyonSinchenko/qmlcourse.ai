(np2ising)=

# Формулировка задач оптимизации в терминах модели Изинга

Мы не зря так глубоко изучали [модель Изинга](ising) и [анализировали](advising) ее решения -- сегодня мы увидим, как в терминах этой модели можно сформулировать большинство важных задач [комбинаторной оптимизации](copt).

(qubo-matrix)=
## QUBO матрица

Но сначала мы кратко обсудим так называемую _QUBO_ матрицу {cite}`glover2019tutorial` -- это еще один способ записать задачу модель Изинга и дальше по курсу мы иногда будем этим пользоваться.

_QUBO_ -- это сокращение от _Quadratic Unconstrainde Binary Optimization_, или, если переводить, то это _задачи квадратичной оптимизации без ограничений_. То есть это такие задачи для которых нет отдельных ограничений, например равенств или неравенств, а функция стоимости включает представима в виде многочлена второй степени от входных переменных. А решением такой задачи является бинарный вектор $X = \{x_1, x_2, ..., x_n\}$ такой, что $x_1, ..., x_n \in \{0, 1\}$. В этом случае функцию стоимости $C$ можно записать в виде:

$$
C = a_1 x_1^2 + a_2 x_2^2 + ... + a_n x_n^2 + b_1 x_1 + ... + b_n x_n + c_{1, 2} x_1 x_2 + c_{1, 3} x_1 x_3 + ... + c_{n, n - 1} x_n x_{n -1}
$$

Но так как наши переменные бинарные, то разницы между $x_i^2$ и $x_i$ нет -- дальше мы будем использовать $a_i$ как единственные коэффициенты считая, что $b_i$ уже так включены туда. И в этом случае можно представить функцию стоимости как матрицу размера $|X| \times |X|$, на диагонали которой стоят коэффициенты $a_1, ..., a_n$, а вне диагонали стоят коэффициенты, с которыми в стоимость входят пары элементов:

$$
Q = \begin{pmatrix}a_1 & c_{1, 2} & ... & c_{1, n} \\
... & ... & ... & ...\\
c_{n, 1} & ... & ... & a_{n}
\end{pmatrix}
$$

А сама оптимизационная задача в этом случае формулируется следующим образом:

$$
\arg\min_{X} {X^T Q X}
$$

```{note}
Тут мы рассматриваем именно минимизацию функции стоимости. Но если исходная задача формулировалась в терминах максимизации чего-то, например, как задача о рюкзаке или максимальном разрезе в графе, то очевидно, что просто домножив стоимость на -1 мы перейдем от максимизации к минимизации. Далее для нас это будет важно, так как мы будем рассматривать нашу задачу как поиск _основного состояния_ квантомеханической системы, а такое состояние это по определению состояние именно с _минимальной_ энергией.
```

## QUBO как квантовый гамильтониан

Если вспомнить, как [выглядит](../problemsblock/advising.html#id2) модель Изинга, то легко заметить, что там у нас как и в _QUBO_-проблемах есть лишь члены первой и второй степени. Вот только [спиновые операторы (матрицы Паули) имеют собственные значения](../qcblock/qubit.html#hat-sigma-z) $\pm 1$, а не $\{0, 1\}$, которые фигурируют в _QUBO_. Это проблема, так как квадраты этих значений не равны им самим. Но это легко можно исправить введя "бинарный" оператор $\hat{x}$:

$$
\hat{x} = \frac{1 + \hat{\sigma}^z}{2} = \begin{pmatrix} 1 & 0 \\ 0 & 0 \end{pmatrix}
$$

Введя "промежуточные" переменные $sz_i$ которые связаны с $x_i$ через это выражение ($x_i = \frac{1 + sz}{2}$ мы всегда можем свести выражение для $C$ к следующему виду:

$$
C = \sum_{i, j \in \{1, ..., |X|\}} J_{i, j} sz_i sz_j + \sum_{i \in {\{1, ..., |X|\}}} h_i sz_i
$$

А это уже почти наша модель Изинга! Заменяем $sz$ на операторы $\sigma^z$ и получаем гамильтониан системы. Причем такой, что минимум его энергии будет совпадать с минимальным значением функции стоимости $C$:

$$
\begin{align*}
& \hat{H} = \sum_{i, j \in \{1, ..., |X|\}} J_{i, j} \sigma^z_i \sigma^z_j + \sum_{i \in {\{1, ..., |X|\}}} h_i \sigma^z_i \\
& \braket{\Psi | \hat{H} | \Psi} = \min {X^T Q X} = \min {C} \quad \text{если }\Psi\text{ - это основное состояние системы}
\end{align*}
$$

Причем в силу того, что у нас в выражении для $\hat{H}$ фигурируют лишь $\sigma^z$, то основное состояние нашего гамильтониана является "классическим", то есть все спины "ориентированы" либо вверх, либо вниз, но не находятся в суперпозиции. Другими словами, наш гамильтониан диагонализируется в $\mathbf{Z}$-базисе.

## Поиск основного состояния

Как мы увидели, задачи, сформулированные в терминах _QUBO_ можно свести к задаче нахождения основного состояния квантовой системы, которая описывается некоторым оператором. Но что это вообще значит? И что это за гамильтониан такой, о котором мы все время говорим? Вообще говоря, гамильтониан это оператор энергии:

$$
\hat{H} = \hat{T} + \hat{U},
$$

где $T$ -- это кинетическая энергия системы, а $U$ -- потенциальная энергия. Именно этот оператор определяет квантовую динамику в уравнении Шредингера. То есть это оператор, зная который (а также начальное состояние системы) можно посчитать волновую функцию системы ($\ket{\Psi}(t)$) в любой момент времени в будущем. Правда это лишь в теории, так как сложность интегрирования уравнения Шредингера очень быстро растет с ростом размера системы. Мы немного касались этой темы в [лекции про виды квантового машинного обучения](../qmlkindsblock/qmlkinds.html#id3), когда рассматривали, как нейросети помогают решать это самое уравнение.

Мы еще коснемся этой темы в следующих лекциях, но пока нам достаточно понимания о том, что гамильтониан полностью описывает квантовую систему. С другой стороны, одновременно, зная гамильтониан мы всегда можем построить "в железе" квантовую систему, которую он описывает. Например, конфигурируя магнитные поля и двухчастичные обменные взаимодействия.

Таким образом, решение проблемы _QUBO_ сводится к поиску $\ket{\Psi}_{GS}$ -- волновой функции, отвечающей основному состоянию:

$$
\arg\min_{\ket{\Psi}} {\hat{H}}
$$

А финальное решение получается просто как наиболее вероятная конфигурация спинов в состоянии $\ket{\Psi}_{GS}$. Ну и останется лишь перейти от полученных собственных значений операторов $\sigma^z_i$ к собственным значениям операторов $\hat{x}_i$.

```{note}
Кстати справедлив и обратный переход, то есть решив проблему QUBO каким нибудь из [классических алгоритмов](problemsblock/copt.html#id9) для решения комбинаторных задач мы автоматически получим конфигурацию основного состояния соответствуеющей физической системы! Этот подход впервые был предложен аж в 1988-м году в работе {cite}`barahona1988application`. Таким образом, мы приходим к пониманию о **тесной связи задач квантовой физики и комбинаторной оптимизации**. Именно на этом и строятся огоромное число перспективных квантовых алгоритмов для решения задач реального мира. Особенно в _NISQ_ эпоху!
```

## Статья Ising formulations of many NP problems

Основным источником информации для нас будет статья _Ising formulations of many NP problems_ {cite}`combinatorics2ising`, вышедшая в 2014-м году. В данной лекции мы рассмотрим лишь часть примеров из этой работы, хотя наше рассмотрение будет чуть более подробным. В целом эта статья может быть использована как прекрасный справочник.

## Задача о максимальном разрезе в графе (повторение)

## Задача коммивояжера

## Задача о выделении сообществ в графе

## Заключение
